@page "/employees"
@inject NavigationManager NavigationManager
@inject UserController Usercontroller
@inject IJSRuntime JSRuntime
@using Syncfusion.Blazor
@using Syncfusion.Blazor.Lists
@using System.Collections.ObjectModel;

<style>
    body { /*achtergrond*/
        background: linear-gradient(to left, #C4A484 50%, transparent 50%), url('https://i.imgur.com/GZVw5gT.png') repeat-x;
        background-color: #E9E9E9;
        background-size: 15500px 300px;
        background-position: 0px 0px;
        display: flex;
        flex-direction: column;
    }

    .mainsquare { /*rechthoek*/
        width: 1200px;
        height: 800px;
        background-color: #099F91;
        border-radius: 10px;
        position: relative;
        top: 100px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .smallersquare { /*grootte kleinere rechthoek in tweede rechthoek*/
        width: 300px;
        height: 800px;
        background-color: #00A89B;
        border-radius: 10px;
        position: absolute;
        top: 0px;
        left: 0px;
        z-index: -1;
    }

    .squareinmainsquare { /*wit rechthoek in main rechthoek*/
        width: 800px;
        height: 700px;
        background-color: #E9E9E9;
        border-radius: 10px;
        position: absolute;
        top: 50px;
        left: 350px;
    }

    .table-container { /*scroll gedeelte als er veel employees zijn*/
        height: 500px;
        overflow-y: scroll;
    }

    .buurtboer-logo {
        width: 300px;
        height: 250px;
        top: 0px;
        left: 0%;
        position: absolute;
    }

    .text-containersquare { /*positie en grootte tekst*/
        display: flex;
        flex-direction: column;
        justify-content: center;
        color: black;
        font-family: monospace;
        font-size: 24px;
        margin-top: 30px;
        margin-left: 325px;
    }

    .trashcan-button {
        width: 40px;
        height: 40px;
        top: 40px;
        left: 717px;
        position: absolute;
    }

    .text-containertrashcan {
        display: flex;
        flex-direction: column;
        justify-content: center;
        position: absolute;
        color: black;
        font-family: monospace;
        font-size: 12px;
        top: 5px;
        margin-left: 710px;
    }

    .savechanges-button {
        background-color: #F9834C;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 15px 0;
        width: 30%;
        font-size: 20px;
        cursor: pointer;
        margin-top: 20px;
        margin-left: 280px;
    }

    .text-containersavechanges { /*tekst onder save changes knop*/
        display: flex;
        flex-direction: column;
        justify-content: center;
        color: black;
        font-family: monospace;
        font-size: 12px;
        margin-top: 10px;
        margin-left: 250px;
    }

    .orange-square-button { /*add knop achtergrond*/
        width: 40px;
        height: 40px;
        margin-top: 10px;
        margin-left: 10px;
        position: absolute;
        cursor: pointer;
        background-color: #F9834C;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .fa-plus { /*plus teken in add knop*/
        font-size: 50px;
        color: white;
        margin-top: 3px;
        margin-left: -3px;
    }

    .text-containeraddbutton {
        display: flex;
        flex-direction: column;
        justify-content: center;
        position: absolute;
        color: black;
        font-family: monospace;
        font-size: 12px;
        margin-top: 20px;
        margin-left: 60px;
    }

    .homescreen-button { /*knop om naar home page te gaan*/
        position: absolute;
        top: 350px;
        left: 30px;
        padding: 20px 0;
        width: 80%;
        background-color: #099F91;
        border: 1px solid #099F91;
        color: white;
        font-size: 16px;
        text-align: center;
        border-radius: 10px;
    }

        .homescreen-button:hover {
            background-color: #F9834C;
        }

    .employee-button { /*knop om naar employees page te gaan*/
        position: absolute;
        top: 425px;
        left: 30px;
        padding: 20px 0;
        width: 80%;
        background-color: #099F91;
        border: 1px solid #099F91;
        color: white;
        font-size: 16px;
        text-align: center;
        border-radius: 10px;
    }

        .employee-button:hover {
            background-color: #F9834C;
        }

    .grocerylist-button { /*knop om naar grocerylist page te gaan*/
        position: absolute;
        top: 500px;
        left: 30px;
        padding: 20px 0;
        width: 80%;
        background-color: #099F91;
        border: 1px solid #099F91;
        color: white;
        font-size: 16px;
        text-align: center;
        border-radius: 10px;
    }

        .grocerylist-button:hover {
            background-color: #F9834C;
        }

    .lunchdata-button { /*knop om naar lunchdata page te gaan*/
        position: absolute;
        top: 575px;
        left: 30px;
        padding: 20px 0;
        width: 80%;
        background-color: #099F91;
        border: 1px solid #099F91;
        color: white;
        font-size: 16px;
        text-align: center;
        border-radius: 10px;
    }

        .lunchdata-button:hover {
            background-color: #F9834C;
        }
</style>

<div class="mainsquare">
    @* HTML elements*@
    <div class="smallersquare">
        <img src="https://i.imgur.com/MF5gfZC.png" class="buurtboer-logo" />
        <button class="homescreen-button" @onclick="HomeScreenRouting">Home</button>
        <button class="employee-button" @onclick="EmployeeRouting">Employees</button>
        <button class="grocerylist-button" @onclick="GroceryListRouting">Grocery List</button>
        <button class="lunchdata-button" @onclick="LunchDataRouting">Lunchdata</button>
    </div>
    <div class="squareinmainsquare">
        <div @onclick="AddEmployeeRouting" class="orange-square-button">
            <i class="fas fa-plus">+</i>
        </div>
        <div class="text-containeraddbutton">
            <p>add employee(s)</p>
        </div>
        <div class="text-containersquare">
            <p>Employees</p>
        </div>
        <div class="text-containertrashcan">
            <p>delete employee(s)</p>
        </div>
        <img src="https://imgur.com/eOCpUcm.png" class="trashcan-button" />
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                    </tr>
                </thead>    
                <tbody>
                    @foreach (var employee in employees)
                    {
                        <tr>
                            <td>@employee.Name</td>
                            <td>@employee.Email</td>
                            <td><input type="checkbox" @onclick="() => CheckboxClicked(employee)" @bind=@employee.IsSelected /></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <button class="savechanges-button" @onclick="SaveChanges">Save Changes</button>
        <div class="text-containersavechanges">
            <p>Click Save Changes to delete selected employees</p>
        </div>
    </div>
</div>

@code {
    ObservableCollection<UserModel> employees = new();
    List<UserModel> employeesToBeDeleted = new();

    private async void SaveChanges() // de knop om de geselecteerde medewerkers te verwijderen.
    {
        if (employeesToBeDeleted.Count() > 0)
        {
            await Usercontroller.DeleteUsers(employeesToBeDeleted.Select(u => u.ID).ToArray()); // deleteusers callen met de ID's van de medewerkers in een array.
            foreach( var employee in employeesToBeDeleted )
            {
                employees.Remove(employee);
            }
            string alert = employeesToBeDeleted.Count() > 1 ? "Users have been deleted!" : "User has been deleted!";
            await JSRuntime.InvokeVoidAsync("alert", alert);
            employeesToBeDeleted.Clear();
            StateHasChanged();
        }
    }

    private void CheckboxClicked(UserModel employee) // als knop geklikt wordt gebruiker toevoegen aan lijst om te verwijderen en anders er weer uit halen.
    {
        // geselecteerd van true naar false of andersom.
        employee.IsSelected = !employee.IsSelected;

        if (employee.IsSelected)
        {
            // gebruiker toevoegen.
            employeesToBeDeleted.Add(employee);
        }
        else
        {
            // Gebruiker verwijderen.
            employeesToBeDeleted.Remove(employee);
        }
    }

    private void temp() // alles omzetten naar een usermodel en de admin van dat moment niet toevoegen aan de lijst.
    {
        foreach (var employee in Usercontroller.Users)
        {
            if (employee.Id == Usercontroller.CurrentUser.Id)
            {
                continue;
            }
            else
            {
                employees.Add(new UserModel
                {
                    Name = employee.FirstName + " " + employee.LastName,
                    Email = employee.Email,
                    IsSelected = false, // Set to false here
                    ID = employee.Id
                });
            }
        }
    }

    public class UserModel
    {
        public string Name { get; set; }
        public string Email { get; set; }
        public bool IsSelected { get; set; }
        public Guid ID { get; set; }
    }

    protected async override Task OnInitializedAsync() // direct wanneer pagina geladen wordt kijken of er iemand is ingelogd en de medewerkers ophalen.
    {
        if (!IsUserLoggedIn())
        {
            NavigationManager.NavigateTo("/login");
        }
        await GetEmployees();
        temp();
        StateHasChanged();
    }

    private bool IsUserLoggedIn() // kijken of gebruiker ingelogd is.
    {
        return Usercontroller.CurrentUser != null;// deze op false zetten zorgt ervoor dat gebruiker direct naar login scherm wordt gestuurd als hij niet ingelogd is.
    }

    private async Task GetEmployees() // alle employees van een bedrijf pakken zodat je ze op het scherm kan laten zien.
    {
        await Usercontroller.GetAllEmployeesPerCompany(Usercontroller.CurrentUser.CompanyId);
    }

    private void HomeScreenRouting()
    {
        NavigationManager.NavigateTo("/home");
    }

    private void EmployeeRouting()
    {
        NavigationManager.NavigateTo("/employees");
    }

    private void GroceryListRouting()
    {
        NavigationManager.NavigateTo("/grocerylist");
    }

    private void LunchDataRouting()
    {
        NavigationManager.NavigateTo("/lunchdata");
    }

    private void AddEmployeeRouting()
    {
        NavigationManager.NavigateTo("/addemployee");
    }
}